#########Azure Monitoring#############
Azure Monitor collects metrics and logs. 
Metric Explorer show all the graphical data
Log data collected by Azure Monitor can be analyzed with queries
Log Analytics in the Azure portal for log support
It Monitors Application monitoring data, Guest OS monitoring data, Azure resource monitoring data, Azure subscription monitoring data
Metrics tell you how the resource is performing and the resources that it's consuming.
Metrics > Select resource group, >Which Resource> Which metrics
Set alert rule> Scope > Condition > Action > Done

Exercise 2: Implementing monitoring and alerting by using Azure Monitor
The main tasks for this exercise are as follows:
Create Azure VM scale set metrics-based alerts
Configure Azure VM scale set autoscaling-based notifications
Test Azure VM scale set monitoring and alerting.

Task 1: Create Azure VM scale set metrics-based alerts
In the Azure portal, navigate to the blade representing the newly deployed Azure VM scale set and, from there, switch to the Monitoring - Metrics blade.
On the Monitoring - Metrics blade, use the filter to display Percentage CPU metric with an aggregation value of Avg of the VM scale set resource you provisioned in the previous exercise of this lab.
Review the resulting chart and note the average percentage CPU within the last few minutes.
Navigate to the Alerts blade in the Monitoring section.
From the Alerts blade, navigate to the Manage actions blade.
In the Manage actions section, click Add action group, set the action group name to az30001 action group, set short name: az30001, select the Azure subscription you used in the previous exercise, accept the default name of the resource group of Default-ActivityLogAlerts (to be created), set the action name: az30001-email, and set the action type to Email/SMS/Push/Voice.
On the Email/SMS/Push/Voice blade, set an email address, a mobile phone number, or a phone number that you want to use to receive alerts generated by this rule.
On the Add action group page, click OK.

Navigate to the Alerts blade.
From the Alerts blade, navigate to the New alert rule blade.
In the Resource section, select the VM scale set you provisioned in the previous exercise of this lab.
In the Condition section, click Add condition, select the Percentage CPU metric, leave the dimension settings and condition type with their default values, set the condition to Greater than, set the type aggregation to Average, set the threshold to 40, set the Aggregation granularity (period) to 1 minute, set the frequency to Every 1 minute and click done.
In the Actions section, click Select action group, select previously created action group az30001 action group and click done.
In the Alert Details section, set the alert rule name to Percentage CPU of the VM scale set is greater than 60 percent, its description to Percentage CPU of the VM scale set is greater than 60 percent, its severity to Sev 3, and set enable rule upon creation to Yes.
Click Create alert rule.

Note: It can take up to 10 minutes for a metric alert rule to become active.

Task 2: Configure Azure VM scale set autoscaling-based notifications
In the Azure portal, navigate to the blade representing the newly deployed Azure VM scale set and, from there, switch to the Scaling blade.
On the Scaling blade, click the Notify tab heading, configure the following settings, and save your changes:
Email administrators: enabled
Email co-administrators: disabled
Additional administrator emails(s): add an email address that you want to use to receive notifications about autoscaling events

Task 3: Test Azure VM scale set monitoring and alerting.
In the Azure portal, search for Load balancers and navigate to the Load Balancers blade. A load balancer should exist, representing the one created with the scale set you deployed from a template in a previous exercise of this lab.
Identify the value of the Public IP address assigned to the front end of the load balancer associated with the VM scale set.
From the lab computer, start Microsoft Edge and browse to http://Public IP address:9000 (where Public IP address is the IP address you identified in the previous step)
On the Worker interface page, click the Start work link.
Use the CPU (average) chart on the VM scale set Overview blade to monitor changes to the CPU utilization.
Note: Alternatively, you can navigate back to the Metrics blade and use the filter to display Percentage CPU metric of the VM scale set resource, and set the time to Last 30 minutes.
Note: You should receive an alert regarding increased CPU utilization within a couple of minutes
Switch to the Instances blade of the VM scale set in order to identify the number of its instances.
Note: Alternatively, you can navigate back to the Scaling blade, in the list of resources capable of autoscaling, click the name of the VM scale set, on the Autoscale settings blade, click Run history, and then review the list of autoscale events.
Note: Autoscaling should be triggered within a couple of minutes.
Switch to the Microsoft Edge window displaying worker instances page and click the Stop work link.
Monitor decrease in CPU utilization and scaling in events using the same methods that you used when scaling out the VM scale set.
Result: After you completed this exercise, you have implemented and tested monitoring and alerting by using Azure Monitor.
